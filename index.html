<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=500">
  <title>Call Notes</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="data/notes.png">
  <style>
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #3b82f6 0%, #222c37 100%);
      color: #f3f3f3;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.97em;
      overflow: hidden;
    }
    html {
      overflow: hidden;
    }
    .container {
      background: rgba(42,54,71,0.45);
      border-radius: 32px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      padding: 32px 32px 12px 32px;
      min-width: 550px;
      width: clamp(550px, 60vw, 480px);
      max-width: 96vw;
      position: relative;
      animation: fadeIn 0.7s;
      border: 1.5px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(18px) saturate(160%) contrast(120%);
      -webkit-backdrop-filter: blur(18px) saturate(160%) contrast(120%);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 {
      text-align: center;
      margin-bottom: 18px;
      font-size: 1.35em;
      font-weight: 700;
      letter-spacing: 1px;
      color: #fff;
      text-shadow: 0 2px 8px #0003;
    }
    label {
      display: block;
      margin-top: 13px;
      margin-bottom: 4px;
      font-weight: 600;
      color: #a5b4fc;
      letter-spacing: 0.5px;
      font-size: 0.98em;
    }
    input, select, textarea, button {
      border-radius: 18px !important;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: none;
      font-size: 0.98em;
      margin-bottom: 4px;
      background: rgba(255,255,255,0.55);
      color: #1b2532;
      box-sizing: border-box;
      transition: box-shadow 0.2s, border 0.2s, background 0.2s, color 0.2s;
      outline: none;
      box-shadow: 0 1px 6px #0001;
      border: 1.5px solid rgba(60,60,100,0.08);
    }
    input:focus, select:focus, textarea:focus {
      box-shadow: 0 0 0 2px #3b82f6, 0 1px 6px #0001;
      border: 1.5px solid #3b82f6;
      background: rgba(255,255,255,0.85);
      color: #181f2a;
    }
    select {
      cursor: pointer;
      background: rgba(255,255,255,0.55) url('data:image/svg+xml;utf8,<svg fill="%231b2532" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.293a1 1 0 011.414 0L10 8.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z"/></svg>') no-repeat right 12px center/18px 18px;
      appearance: none;
    }
    textarea {
      min-height: 330px;
      resize: vertical;
      margin-top: 10px;
      font-family: 'Fira Mono', 'Consolas', monospace;
      font-size: 0.97em;
      background: rgba(255,255,255,0.55);
      color: #1b2532;
      border: 1.5px solid rgba(60,60,100,0.08);
      box-shadow: 0 2px 8px #0001;
    }
    button {
      background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%);
      color: #fff;
      border: none;
      border-radius: 18px;
      padding: 10px 0;
      font-size: 1em;
      font-weight: 700;
      width: 100%;
      margin-top: 14px;
      cursor: pointer;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.2s, transform 0.1s;
      letter-spacing: 0.5px;
    }
    button:active {
      transform: scale(0.98);
    }
    button.copied {
      background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
    }
    button.clear {
      background: linear-gradient(90deg, #f87171 0%, #ef4444 100%) !important;
      color: #fff !important;
      transition: background 0.2s, color 0.2s;
    }
    button.undo {
      background: linear-gradient(90deg, #f87171 0%, #ef4444 100%) !important;
      color: #fff !important;
      transition: background 0.2s, color 0.2s;
    }
    .note-label {
      margin-top: 22px;
      font-weight: 600;
      color: #a5b4fc;
      font-size: 1.08em;
    }
    .footer {
      text-align: center;
      margin-top: 22px;
      color: #a5b4fc;
      font-size: 0.92em;
      letter-spacing: 0.5px;
      border-radius: 18px;
    }
    .field-group {
      display: flex;
      gap: 16px;
    }
    .field-group > div {
      border-radius: 18px;
    }
    /* Custom iOS-style checkbox */
    input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 8px;
      border: 2px solid #a5b4fc;
      background: rgba(255,255,255,0.7);
      transition: border-color 0.2s, background 0.2s;
      position: relative;
      cursor: pointer;
      outline: none;
      box-shadow: 0 1px 4px #0001;
      margin-right: 4px;
      display: inline-block;
      vertical-align: middle;
    }
    input[type="checkbox"]:checked {
      background: linear-gradient(90deg, #6366f1 0%, #3b82f6 100%);
      border-color: #6366f1;
    }
    input[type="checkbox"]:checked::after {
      content: '';
      display: block;
      position: absolute;
      left: 6px;
      top: 2px;
      width: 7px;
      height: 13px;
      border: solid #fff;
      border-width: 0 3px 3px 0;
      border-radius: 2px;
      transform: rotate(45deg);
    }
    input[type="checkbox"]:focus {
      box-shadow: 0 0 0 2px #a5b4fc44;
      border-color: #6366f1;
    }
    .input-icon-group label {
      margin-bottom: 2px;
      font-weight: 600;
      color: #a5b4fc;
      letter-spacing: 0.5px;
      font-size: 0.98em;
    }
    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #3b82f6;
      opacity: 0.8;
      font-size: 1.1em;
      pointer-events: none;
      z-index: 2;
    }
    .input-icon-group input {
      padding-left: 38px !important;
    }
    .input-icon-group > div {
      position: relative;
    }
    @media (max-width: 600px) {
      .container {
        min-width: unset;
        width: 99vw;
        padding: 10px 2px 10px 2px;
      }
      h1 {
        font-size: 1em;
      }
      textarea {
        min-height: 120px;
      }
    }
    .input-icon-group select {
      padding-left: 44px !important;
      padding-right: 38px !important;
      background: rgba(255,255,255,0.55);
      color: #1b2532;
      border: none;
      font-size: 0.98em;
      margin-bottom: 4px;
      box-sizing: border-box;
      border-radius: 18px !important;
      box-shadow: 0 1px 6px #0001;
      border: 1.5px solid rgba(60,60,100,0.08);
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    .input-icon-group select:focus {
      box-shadow: 0 0 0 2px #3b82f6, 0 1px 6px #0001;
      border: 1.5px solid #3b82f6;
      background: rgba(255,255,255,0.85);
      color: #181f2a;
    }
    .input-select-arrow {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #3b82f6;
      opacity: 0.7;
      font-size: 1em;
      pointer-events: none;
      z-index: 2;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="container">
    <form id="noteForm" autocomplete="off">
      <div class="field-group">
        <div class="input-icon-group" style="flex:1;min-width:0;">
          <label for="name"><span>Full Name</span></label>
          <div style="position:relative;">
            <i class="fa-solid fa-user input-icon"></i>
            <input type="text" id="name" required placeholder="John Doe">
          </div>
        </div>
        <div class="input-icon-group" style="flex:1;min-width:0;">
          <label for="contact"><span>Contact Number</span></label>
          <div style="position:relative;">
            <i class="fa-solid fa-phone input-icon"></i>
            <input type="text" id="contact" required placeholder="(555) 555-5555">
          </div>
        </div>
      </div>
      <div class="input-icon-group">
        <label for="confirmation"><span>Confirmation Number</span></label>
        <div style="position:relative;">
          <i class="fa-solid fa-hashtag input-icon"></i>
          <input type="text" id="confirmation" required placeholder="73734552">
        </div>
      </div>
      <div class="input-icon-group">
        <label for="reason"><span>Reason for Call</span></label>
        <div style="position:relative;">
          <i class="fa-solid fa-list input-icon"></i>
          <select id="reason" style="padding-left:44px; appearance:none; background:rgba(255,255,255,0.55);">
            <option disabled selected value="">Select a reason...</option>
            <option>Modify Reservation</option>
            <option>Too Late to Cancel</option>
            <option>Request Receipt</option>
            <option>Hotel Complaint</option>
          </select>
          <i class="fa-solid fa-chevron-down input-select-arrow" style="position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#3b82f6;opacity:0.7;font-size:1em;pointer-events:none;"></i>
        </div>
      </div>
      <div class="input-icon-group">
        <label for="hotelResponse"><span>Response</span></label>
        <div style="position:relative;">
          <i class="fa-solid fa-comment-dots input-icon"></i>
          <input type="text" id="hotelResponse" placeholder="Tip: Press Enter to add multiple responses">
        </div>
      </div>
      <div class="input-icon-group">
        <label for="hotelContact"><span>Hotel Contact</span></label>
        <div style="position:relative;">
          <i class="fa-solid fa-user-tie input-icon"></i>
          <input type="text" id="hotelContact" placeholder="Manager Bill">
        </div>
      </div>
      <div style="margin: 6px 0 0 0; display: flex; align-items: center; gap: 8px; justify-content: center;">
        <input type="checkbox" id="hotelUnreachable" style="width:16px;height:16px;">
        <label for="hotelUnreachable" style="margin:0;font-weight:400;font-size:0.97em;cursor:pointer;">Could not reach hotel</label>
      </div>
      <textarea id="note"></textarea>

      <button type="button" id="copyBtn">Copy to Clipboard</button>
    </form>
    <div class="footer">
      <a href="mailto:dylatwad@gmail.com" style="color:#a5b4fc;text-decoration:underline dotted 1.5px;opacity:0.7;font-size:0.98em;transition:opacity 0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.7">dylatwad@gmail.com</a>
    </div>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js');
      });
    }

    const nameInput = document.getElementById('name');
    const contactInput = document.getElementById('contact');
    const confirmationInput = document.getElementById('confirmation');
    const reasonSelect = document.getElementById('reason');
    const hotelResponseInput = document.getElementById('hotelResponse');
    const hotelContactInput = document.getElementById('hotelContact');
    const hotelUnreachableCheckbox = document.getElementById('hotelUnreachable');
    const noteArea = document.getElementById('note');
    const copyBtn = document.getElementById('copyBtn');

    // Store multiple responses
    let responseLines = [];

    hotelResponseInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const val = hotelResponseInput.value.trim();
        if (val) {
          responseLines.push(val);
          hotelResponseInput.value = '';
          hotelResponseInput.style.outline = '2.5px solid #22c55e';
          setTimeout(() => {
            hotelResponseInput.style.outline = '';
          }, 400);
          updateNote();
        }
      }
    });

    hotelResponseInput.addEventListener('input', function() {
      updateNote();
    });

    function getHotelContactLine() {
      const contact = hotelContactInput.value.trim();
      const unreachable = hotelUnreachableCheckbox.checked;
      if (contact) {
        return `– Spoke with ${contact} at the hotel\n`;
      } else if (unreachable) {
        return `– Attempted to reach hotel unsuccessfully.\n`;
      } else {
        return `– Contacted hotel for possible changes\n`;
      }
    }

    function getBottomTemplate(reason, _hotelResponse, name) {
      // Always include all entered lines plus the current field value (if not empty)
      let allResponses = responseLines.slice();
      if (hotelResponseInput.value.trim()) {
        allResponses.push(hotelResponseInput.value.trim());
      }
      let responseLine = allResponses.length ? allResponses.map(r => `– ${r}\n`).join('') : '';
      let modifyLine = responseLine;
      let complaintLine = responseLine || '– Documented complaint details\n';
      const hotelContactLine = getHotelContactLine();
      const hasHotelContact = hotelContactInput.value.trim() || hotelUnreachableCheckbox.checked;
      const templates = {
        "Too Late to Cancel":
          `– ${name} called and stated that they needed to cancel a reservation\n– ${name} provided confirmation number and reservation was verified\n– Advised ${name} that reservation was listed as too late to cancel and explain policy\n– Gave sorry/empathy statement\n${hotelContactLine}${responseLine}– Advised ${name} of above\n– Provided ${name} CR ticket number\n– Sent to member web for hotel records\n– Closed ticket`,
        "Modify Reservation":
          `– ${name} called to modify reservation\n– Provided confirmation number and verified reservation\n– Explained modification/cancellation policy\n${hotelContactLine}${modifyLine}– Advised ${name} accordingly\n– Provided CR ticket number\n– Closed ticket`,
        "Request Receipt":
          hasHotelContact
            ? `– ${name} requested receipt for stay\n– Verified ${name.toLowerCase()} information and stay details\n${hotelContactLine}${responseLine}– Sent receipt to ${name.toLowerCase()}'s email address on file\n– Provided CR ticket number\n– Closed ticket`
            : `– ${name} requested receipt for stay\n– Verified ${name.toLowerCase()} information and stay details\n– Sent receipt to ${name.toLowerCase()}'s email address on file\n– Provided CR ticket number\n– Closed ticket`,
        "Hotel Complaint":
          `– ${name} called with complaint about hotel stay\n– Listened to ${name.toLowerCase()}'s concerns\n– Apologized and expressed empathy\n${complaintLine}${hotelContactLine}– Advised ${name} of outcome\n– Provided CR ticket number\n– Closed ticket`,
        "":
          (hasHotelContact ? hotelContactLine : "") + responseLine || '– No additional details provided.'
      };
      return templates[reason] || templates[""];
    }

    function updateNote() {
      const name = nameInput.value.trim() || 'Guest';
      const contact = contactInput.value.trim();
      const confirmation = confirmationInput.value.trim();
      const reason = reasonSelect.value;
      const top = `Guest Name: ${name}\nBest Callback Number: ${contact}\nConfirmation Number: ${confirmation}\nReason For Call: ${reason}\n`;
      const bottom = getBottomTemplate(reason, '', name);
      noteArea.value = `${top}\n${bottom}`;
    }

    // Auto-update note on input
    [nameInput, confirmationInput, reasonSelect, hotelResponseInput, hotelContactInput, hotelUnreachableCheckbox].forEach(el => {
      el.addEventListener('input', updateNote);
      el.addEventListener('change', updateNote);
    });

    // Phone number formatting
    const formatPhoneNumber = (value) => {
      // Remove all non-digit characters
      const digits = value.replace(/\D/g, '');
      if (digits.length === 0) return '';
      if (digits.length < 4) return `(${digits}`;
      if (digits.length < 7) return `(${digits.slice(0,3)}) ${digits.slice(3)}`;
      return `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6,10)}`;
    };

    contactInput.addEventListener('input', (e) => {
      const cursor = contactInput.selectionStart;
      const prev = contactInput.value;
      const formatted = formatPhoneNumber(prev);
      contactInput.value = formatted;
      // Try to keep cursor at end for most cases
      contactInput.setSelectionRange(formatted.length, formatted.length);
      updateNote();
    });

    // Mutually exclusive logic
    hotelContactInput.addEventListener('input', () => {
      if (hotelContactInput.value.trim()) {
        hotelUnreachableCheckbox.checked = false;
      }
      // Always keep checkbox enabled
    });
    hotelUnreachableCheckbox.addEventListener('change', () => {
      if (hotelUnreachableCheckbox.checked) {
        hotelContactInput.value = '';
      }
      // Always keep contact input enabled
      updateNote();
    });

    // Allow manual edits to note
    noteArea.addEventListener('input', () => {});

    let clearTimeoutId = null;
    let isClearMode = false;
    let lastFormState = null;
    let isUndoMode = false;

    function getFormState() {
      return {
        name: nameInput.value,
        contact: contactInput.value,
        confirmation: confirmationInput.value,
        hotelResponse: hotelResponseInput.value,
        hotelContact: hotelContactInput.value,
        hotelUnreachable: hotelUnreachableCheckbox.checked,
        reason: reasonSelect.value,
        note: noteArea.value
      };
    }
    function setFormState(state) {
      nameInput.value = state.name;
      contactInput.value = state.contact;
      confirmationInput.value = state.confirmation;
      hotelResponseInput.value = state.hotelResponse;
      hotelContactInput.value = state.hotelContact;
      hotelUnreachableCheckbox.checked = state.hotelUnreachable;
      reasonSelect.value = state.reason;
      updateNote();
    }

    function resetCopyBtn() {
      copyBtn.classList.remove('clear','undo');
      copyBtn.classList.remove('copied');
      copyBtn.innerHTML = 'Copy to Clipboard';
      isClearMode = false;
      isUndoMode = false;
      if (clearTimeoutId) {
        clearTimeout(clearTimeoutId);
        clearTimeoutId = null;
      }
    }

    function setClearBtn() {
      copyBtn.classList.remove('copied','undo');
      copyBtn.classList.add('clear');
      copyBtn.innerHTML = 'Clear?';
      isClearMode = true;
      isUndoMode = false;
      if (clearTimeoutId) clearTimeout(clearTimeoutId);
      clearTimeoutId = setTimeout(resetCopyBtn, 15000);
    }

    function setUndoBtn() {
      copyBtn.classList.remove('clear','copied');
      copyBtn.classList.add('undo');
      copyBtn.innerHTML = 'Undo';
      isUndoMode = true;
      isClearMode = false;
      if (clearTimeoutId) clearTimeout(clearTimeoutId);
      clearTimeoutId = setTimeout(resetCopyBtn, 15000);
    }

    copyBtn.addEventListener('click', () => {
      if (isUndoMode && lastFormState) {
        setFormState(lastFormState);
        resetCopyBtn();
        return;
      }
      if (isClearMode) {
        lastFormState = getFormState();
        // Clear all text fields
        nameInput.value = '';
        contactInput.value = '';
        confirmationInput.value = '';
        hotelResponseInput.value = '';
        hotelContactInput.value = '';
        hotelUnreachableCheckbox.checked = false;
        updateNote();
        setUndoBtn();
        return;
      }
      noteArea.select();
      document.execCommand('copy');
      copyBtn.classList.add('copied');
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        setClearBtn();
      }, 400);
    });

    // If user edits any field, reset button (and clear undo state)
    [nameInput, contactInput, confirmationInput, reasonSelect, hotelResponseInput, hotelContactInput, hotelUnreachableCheckbox, noteArea].forEach(el => {
      el.addEventListener('input', () => {
        if (isUndoMode) lastFormState = null;
        resetCopyBtn();
      });
      el.addEventListener('change', () => {
        if (isUndoMode) lastFormState = null;
        resetCopyBtn();
      });
    });

    // Initial note
    updateNote();
  </script>
</body>
</html>
